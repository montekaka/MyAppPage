<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
<h1><%= App.find_by_id(params[:id]).trackName %></h1>
<div class="col-lg-12">
  <div id="container" style="min-width: 300px; height: 400px; margin: 0 auto"></div>
</div>

<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Page View</th>
      <th>iTunes Click</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @pagecounts.each do |pagecount| %>
      <tr>
        <td><%= pagecount.mixpanel_data %></td>
        <td><%= pagecount.pageview %></td>
        <td><%= pagecount.itunes_clicks %></td>
        <td><%= link_to 'Show', pagecount %></td>
        <td><%= link_to 'Edit', edit_pagecount_path(pagecount) %></td>
        <td><%= link_to 'Destroy', pagecount, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Pagecount', new_pagecount_path %>
<script>
var mixpanel_data = [];
var pageview = [];
var itunes_clicks = [];

<% @pagecounts.each do |pagecount| %>
  mixpanel_data.push('<%=pagecount.mixpanel_data %>');
  pageview.push(<%=pagecount.pageview %>);
  itunes_clicks.push(<%=pagecount.itunes_clicks %>);
<% end %>

mixpanel_data = mixpanel_data.reverse();
pageview = pageview.reverse();
itunes_clicks = itunes_clicks.reverse();

console.log(pageview);

$(function () {
        $('#container').highcharts({
            chart: {
                type: 'column'
            },
            title: {
                text: '<%=App.find_by_id(params[:id]).trackName %>'
            },
            subtitle: {
                text: 'Source: Mixpanel.com'
            },
            xAxis: {
                categories: mixpanel_data
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'Clicks'
                }
            },
            tooltip: {
                headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                    '<td style="padding:0"><b>{point.y:.1f} </b></td></tr>',
                footerFormat: '</table>',
                shared: true,
                useHTML: true
            },
            plotOptions: {
                column: {
                    pointPadding: 0.2,
                    borderWidth: 0
                }
            },
            series: [{
                name: 'Page View',
                data: pageview
    
            }, {
                name: 'iTunes Clciks',
                data: itunes_clicks
    
            }]
        });
    });
    
</script>